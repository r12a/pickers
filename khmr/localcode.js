globals.showHuffmanTrans =  ''
globals.showGilbertTrans = ''
globals.showTransliterate = ''
globals.typeAssist = ' ✓'
globals.showKeysTranslitToggle = false


function localInitialise () {

	}



var _h = {
'1780': ['1782', '178F', '1797', '17A5'],
'1781': ['178C', '17A7', '17A9', '17AA', '17B1', '17B3'],
'1782': ['1780', '178F', '1797', '17A5'],
'1783': ['1799'],
'1785': ['1790'],
'1784': ['1787', '1795', '178A', '1786', '1792'],
'1786': ['1792', '1784', '1787', '1795', '178A'],
'1788': ['1783', '1799'],
'1789': ['17E3'],
'178A': ['1787', '1795', '1784', '1786', '1792'],
'178B': ['1794', '17AB', '17AC'],
'178C': ['17A7', '1781'],
'178D': ['179B', '17A6', '17E7', '1788'],
'178F': ['1797', '1782', '1780', '17A5'],
'1790': ['1785', '178B'],
'1791': ['17A1'],
'1792': ['1786', '178A', '1787', '1795', '1784'],
'1793': ['17A7'],
'1794': ['178B', '17AB', '17AC'],
'1795': ['1787', '178A', '1784', '1792', '1786'],
'1796': ['17AD', '17AE', '17B0', '178D', '17E7'],
'1797': ['178F', '1782', '1780', '17A5'],
'1798': ['1794'],
'1799': ['1783'],
'179B': ['179F', '178D'],
'17A1': ['1791'],
'179A': ['179C', '17C1', '17DB'],
'179F': ['179B', '178D'],
'179C': ['179A', '17C1', '17DB'],
'17A5': ['1780'],
'17A6': ['1796'],
'17A7': ['178C', '1781', '17A9', '17AA', '17B1', '17B3'],
'17A9': ['17A7', '178C', '1781', '17AA', '17B1', '17B3'],
'17AA': ['17B1', '17B3', '17A7'],
'17B1': ['17B3', '17AA', '17A7'],
'17B3': ['17B1', '17AA', '17A7'],
'17B0': ['17AD', '17AE', '1796'],
'17AB': ['17AC', '1794', '178B'],
'17AC': ['17AB', '1794', '178B'],
'17AD': ['17AE', '1796', '17B0'],
'17AE': ['17AD', '1796', '17B0'],
'1784': ['17E5'],
'17E5': ['1784'],
'17B6': ['17B617C6', '17C4', '17C417C7'],
'17B617C6': ['17B6'],
'17BB17C6': ['17C6', '17BB'],
'17BB': ['17BB17C6', '17BB17C7'],
'17BB17C7': ['17BB', '17C7'],
'17C1': ['17C117C7', '17C2', '17C3', '17C4', '17C417C7', '17C5', '17BE', '17BF', '17C0', '179A', '179C', '17DB'],
'17C117C7': ['17C1', '17C7', '17C417C7'],
'17C2': ['17C3', '179A', '179C', '17DB'],
'17C3': ['17C2', '179A', '179C', '17DB'],
'17C4': ['17C1', '17B6', '179A', '179C', '17DB'],
'17C417C7': ['17C1', '17B6', '17C7', '179A', '179C', '17DB'],
'17C5': ['17C4', '17C417C7', '179A', '179C', '17DB'],
'17BE': ['17BF', '17C1', '179A', '179C', '17DB'],
'17BF': ['17BE', '17BA', '17C1', '179A', '179C', '17DB', '17C0'],
'17C0': ['17C1', '179A', '179C', '17DB', '17BF'],
'17C6': ['17BB17C6', '17B617C6'],
'17C7': ['17BB17C7', '17C117C7', '17D6'],
'17C8': ['17C7', '17D6'],
'17D0': ['178A'],
'17D7': ['17D4', '17D4179B17D4'],
'17D4179B17D4': ['17D7', '179B'],
'17D4': ['17D5', '17D7'],
'17D6': ['17C7'],
'17D9': ['17E0'],
'17E7': ['178D', '1796'],
'17E3': ['1789'],
'17DB': ['179A', '179C', '17C1'],
'1787': ['1790', '1785'],
'17A4': ['17A2', '17B6'],
'17A3': ['17A2'],
'17D3': ['17C6'],
'17A8': ['17AA', '17B1', '17B3'],
'179D': ['1782', '1780'],
'179E': ['1798', '1794'],
'17D2179E': ['17D21783', '17D21794'],
'17DC': ['1793'],
'17D8': ['17D4179B17D4'],

end: {}
}


/*
ក គ ត ភ ឥ
ខ ឌ ឧ ឩ ឪ ឱ ឳ
គ ក ត ភ ឥ
ឃ យ
ច ថ
ង ជ ផ ដ ឆ ធ
ឆ ធ ង ជ ផ ដ
ឈ ឃ យ
ញ ៣
ដ ជ ផ ង ឆ ធ
ឋ ប ឫ ឬ
ឌ ឧ ខ
ឍ ល ឦ ៧ ឈ
ត ភ គ ក ឥ
ថ ច ឋ
ទ ឡ
ធ ឆ ដ ជ ផ ង
ន ឧ
ប ឋ ឫ ឬ
ផ ជ ដ ង ធ ឆ
ព ឭ ឮ ឰ ឍ ៧
ភ ត គ ក ឥ
ម ប
យ ឃ
ល ស ឍ
ឡ ទ
រ វ េ ៛
ស ល ឍ
វ រ េ ៛
ឥ ក
ឦ ព
ឧ ឌ ខ ឩ ឪ ឱ ឳ
ឩ ឧ ឌ ខ ឪ ឱ ឳ
ឪ ឱ ឳ ឧ
ឱ ឳ ឪ ឧ
ឳ ឱ ឪ ឧ
ឰ ឭ ឮ ព
ឫ ឬ ប ឋ
ឬ ឫ ប ឋ
ឭ ឮ ព ឰ
ឮ ឭ ព ឰ
ង ៥
៥ ង
ា ាំ ោ ោះ
ាំ ា
ុំ ំ ុ
ុ ុំ ុះ
ុះ ុ ះ
េ េះ ែ ៃ ោ ោះ ៅ ើ ឿ ៀ រ វ ៛
េះ េ ះ ោះ
ែ ៃ រ វ ៛
ៃ ែ រ វ ៛
ោ េ ា រ វ ៛
ោះ េ ា ះ រ វ ៛
ៅ ោ ោះ រ វ ៛
ើ ឿ េ រ វ ៛
ឿ ើ ឺ េ រ វ ៛ ៀ
ៀ េ រ វ ៛ ឿ
ំ ុំ ាំ
ះ ុះ េះ ៖
ៈ ះ ៖
័ ដ
ៗ ។ ។ល។
។ល។ ៗ ល
។ ៕ ៗ
៖ ះ
៙ ០
៧ ឍ ព
៣ ញ
៛ រ វ េ
ជ ថ ច
ឤ អ ា
ឣ អ
៓ ំ
ឨ ឪ ឱ ឳ
ឝ គ ក
ឞ ម ប
្ឞ ្ឃ ្ប
ៜ ន
៘ ។ល។

*/




var keyboarddef = [
"§|1 ១ !|2 ២ ៗ|3 ៣ \"|4 ៤ ៛|5 ៥ %|6 ៦ ៍ ៙|7 ៧ ័ ៚|8 ៨ ៏|9 ៩ ឰ|0 ០ ឳ|- ឥ ៌|= ឲ ៎ ់",
"q ឆ ឈ|w ឹ ឺ|e េ ែ|r រ ឬ|t ត ទ ថ|y យ ួ|u ុ ូ|i ិ ី|o ោ ៅ|p ផ ភ|[ ៀ ឿ ឨ|] ឪ ឧ ឩ",
"a ា ឫ ៜ|s ស ៃ ឝ|d ដ ឌ ឞ|f ថ ធ|g ង អ|h ហ ះ|j ្ ញ|k ក គ|l ល ឡ|; ើ ៖|' ់ ៉|\\ ឭ ឮ",
"` « »|z ឋ ឍ|x ខ ឃ|c ច ជ|v វ ៈ|b ប ព|n ន ណ|m ម ំ|, ឦ ឱ|. ។ ៕|/ ៊ ឯ"
]



function toggleSubjoined (node) {
	var chars = document.querySelectorAll('.x')
	if (! node.classList.contains('shifted')) {
		for (i=0;i<chars.length;i++) chars[i].style.display = 'inline-block'
		}
	else {
		for (i=0;i<chars.length;i++) chars[i].style.display = 'none'
		}
	}

function condense (str) {
	// removes spaces and hyphens from a string

	// if text isn't highlighted, highlight whole thing (to avoid duplication)
	var node = document.getElementById('output')
	//IE support
	if (document.selection) { 
	    chstring = document.selection.createRange()
		}
	// Mozilla and Safari support
	else if (node.selectionStart || node.selectionStart == '0') {
		chstring = node.value.substring(node.selectionStart, node.selectionEnd)
		}
	if (chstring == '') { chstring = node.select() }

	// do the replacement
	str = str.replace(/ /g, '')
	str = str.replace(/-/g, '')

	return str
	}



function sendVowelLeft (str) {
	lv = str.match(/เ|แ|ไ|โ|ใ/)
	if (lv == null) return
	
	return lv+str.substr(0,lv.index)+str.substr(lv.index+1)
	}


function syllabify (str) {
    // puts spaces between orthographic syllables
    // useful as a prelude to IPA transcription
    
    var consonants = new Set(['ក', 'ខ', 'គ', 'ឃ', 'ង', 'ច', 'ឆ', 'ជ', 'ឈ', 'ញ', 'ដ', 'ឋ', 'ឌ', 'ឍ', 'ណ', 'ត', 'ថ', 'ទ', 'ធ', 'ន', 'ប', 'ផ', 'ព', 'ភ', 'ម', 'យ', 'ល', 'ឡ', 'រ', 'អ', 'ស', 'ហ', 'វ'])
    var independentVowels = new Set(['ឥ', 'ឦ', 'ឧ', 'ឩ', 'ឪ', 'ឯ', 'ឰ', 'ឱ', 'ឲ', 'ឳ', 'ឫ', 'ឬ', 'ឭ', 'ឮ'])

    str = ' '+str+' '
    
    let chars = [...str]
    
    // in first pass, add spaces before non-conjoined consonants
    var firstpass = ''
    for (let i=1;i<str.length-1;i++) {
        console.log(str[i])
        if (consonants.has(str[i]) && str[i-1] !== '\u17D2') firstpass += ' '+str[i]
        else firstpass += str[i]
        }
    var syllables = firstpass.trim().split(' ')
    
    // optimise by moving spaces in certain arrangements
    var out = ''
    for (let i=0; i<syllables.length; i++) {
        // move a final consonant or consonant-only cluster next to preceding orthographic syllable
        //if (i===syllables.length-1 && syllables[i].length === 1) out += syllables[i]
        if (i===syllables.length-1 && consonants.has(syllables[i][syllables[i].length-1])) out += syllables[i]
        else out += ' '+syllables[i]
        }
        
    // move nasals starting conjuncts to previous syllable
    out = out.replace(/ (\u1793)\u17D2/g, '$1\u17D2 ')

    // move consonant with bantok to previous syllable
    out = out.replace(/ (.)\u17CB/g, '$1\u17CB ')
    
    
    return out.trim()
    }




var huffmanCharacterMap = `
b b ប
c c ច c ជ c ឆ c ឈ ch ឆ ch ឈ
d d ដ d ត d ឌ
f f ហ្វ
h h ស
k k ក k គ k ខ k ឃ kh ខ kh ឃ
l l ល l ឡ
m m ម
n n ណ n ន n̄ ញ ŋ ង
p p ព p ប p ប៉ p ផ p ភ ph ផ ph ភ
r r រ
s s ស
t t ត t ទ t ដ t ឋ t ឌ t ឍ t ធ th ឋ th ឍ th ថ th ធ
w w វ
y y យ
a a ័ a ា a ់ a ៈ aa ា aə ើ ae ែ ae ឯ ah ះ am ាំ aŋ ាំង aŋ ំ aŋ ាំង aŋ ំ ao ោ ao ឧ ao ឱ ao ឲ aw ៅ aw ឳ ay ័យ ay ័ៃ ay ័ឰ ɑ ់  ɑh ោះ ɑh ស់ ɑm ំ ɑm ម់
e e ិ ee េ eə̆ ័ eə̆ ា eə̆ ់ eə̆ ៈ eə̆h ះ eə̆h ាះ eə̆ŋ ាំង eh ិះ eh េះ eh ែះ eh ែស ei េ ə ិ ə ឹ ə េ ə ឥ əə ើ əh ើះ ើះ əh əɨ ឺ əw ូវ əw ឪ əy ិយ əy ី əy ឥ əy ឦ ɛ ិ ɛɛ ែ
i i ិ ii ិយ ii ី iə ា iə ៀ ih ិះ ih េះ ɨ ិ ɨ ឹ ɨ េ ɨ ឥ ɨɨ ឺ ɨə ឿ ɨw ូវ ɨw ៅ ɨy ័យ ɨy ៃ ɨy េយ
o o ុ o ឧ oo ោ oə̆ ័ oə̆ ា oə̆ ់ oh ុះ oə̆m ាំ om ុំ ou ូ ou ឩ ɔə ័រ ɔə ៌
u u ុ u ់ u ឧ uu ូ uu ឩ uə ួ uə̆ ់ uə̆ ់ uə̆h ោះ uə̆h ស់ uh ុះ um ម់ um ុំ um ំ um ុម up ប់
R rə ៌ rɨ ឫ rɨɨ ឬ
L lɨ ឭ lɨɨ ឮ
`


var gilbertCharacterMap = `
b b ប b ព b ភ bp ព bp ប៉
c ch ឆ ch ឈ
d d ដ d ត d ឌ dt ត dt ទ
f f ហ្វ
g g ក g គ
h h ហ h ស
j j ហ j ស
k k ខ k ឃ k ក k គ
l l ល l ឡ
m m ម
n n ណ n ន n̄ ញ ng ង
p p ផ p ប៉ p ប p ផ p ភ
q q អ q ក q គ q ខ q ឃ
r r រ
s s ស
t t ថ t ធ t ឋ t ឍ t ទ t ដ t ឋ t ឍ t ត
T th ឋ th ឍ th ថ th ធ
v vw វ
w w វ
y y យ
a a ា a ់ a ័ a ៈ aa ា ae ែ ae ឯ ah ះ ai ៃ ai ឰ
A am ាំ ang ាំង ao ោ ao ឱ au ៅ aʉ ើ ay ័យ
e e ិ e ័ ee េ ee េ ee ឦ eh េះ eh ិះ ei ៃ ei ឥ ey ី ey ័យ
E ə ឹ ə ឹ əə ើ əm ំ əʉ ៅ ɛɛ ែ ɛa ា ɛa ់ ɛah ះ ɛah ៈ ɛang ាំង
i i ិ ii ី ii យ ia ា ia ៀ ih េះ ih ិះ ik ច ik ជ
o o ុ o ់ oo ូ oo ោ oo ឧ oa ា oa ់ oa ៌ oa ័ oa ័រ oam ាំ oh ុះ om ុំ ow ឪ
O ɔɔ អ ɔh ោះ ɔm ំ
u u ុ uu ូ ua ួ uah ោះ uh ុះ um ុំ ʉʉ ឺ ʉa ឿ
R re ឫ rʉʉ ឬ
L lə ឭ lʉʉ ឮ
`






